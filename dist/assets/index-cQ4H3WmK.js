(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class y{static get(t,e=null){try{const o=localStorage.getItem(t);return o?JSON.parse(o):e}catch(o){return console.error(`L·ªói khi ƒë·ªçc ${t}:`,o),e}}static set(t,e){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(o){return console.error(`L·ªói khi l∆∞u ${t}:`,o),!1}}static remove(t){localStorage.removeItem(t)}static clear(){localStorage.clear()}static getAllData(){return{diaryEntries:this.get("diaryEntries",[]),moments:this.get("moments",[]),settings:this.get("diarySettings",{}),exportDate:new Date().toISOString()}}static initializeDefaults(){this.get("diaryEntries")||this.set("diaryEntries",[]),this.get("moments")||this.set("moments",[]),this.get("diarySettings")||this.set("diarySettings",{theme:"mint"})}}function R(){const l=y.get("diarySettings",{theme:"mint"}).theme;P(l)}function P(l){console.log("Setting theme to:",l),document.body.classList.remove("theme-mint","theme-pink","theme-lavender","theme-ocean","theme-night"),document.body.classList.add(`theme-${l}`),window.APP_STATE&&(window.APP_STATE.currentTheme=l);const t=y.get("diarySettings",{});t.theme=l,y.set("diarySettings",t);const e=document.getElementById("theme-panel");e&&e.classList.add("hidden"),window.ChartManager&&window.APP_STATE?.currentView==="report"&&setTimeout(()=>{window.ChartManager.drawCharts()},100),_()}function _(){const l=getComputedStyle(document.body).getPropertyValue("--accent-light"),t=getComputedStyle(document.body).getPropertyValue("--button-bg");document.querySelectorAll(".mood-btn").forEach(e=>{e.classList.contains("ring-4")?e.style.backgroundColor=t:e.style.backgroundColor=l})}class f{static calculateStreak(){const t=y.get("diaryEntries",[]);if(t.length===0)return 0;const e=new Set(t.map(s=>s.date)),o=Array.from(e).map(s=>{const[r,a,d]=s.split("/").map(Number);return new Date(d,a-1,r)}).sort((s,r)=>r-s);let i=0;const n=new Date;n.setHours(0,0,0,0);for(let s=0;s<o.length;s++){const r=new Date(n);if(r.setDate(r.getDate()-s),r.setHours(0,0,0,0),o[s].getTime()===r.getTime())i++;else break}return i}static updateStreakCounter(){const t=this.calculateStreak(),e=document.getElementById("streak-counter");e&&(e.innerHTML=`üî• ${t} ng√†y li√™n ti·∫øp`,t>0&&e.classList.add("animate-pulse"))}static setupPhotoUpload(){document.querySelectorAll(".photo-upload").forEach((t,e)=>{t.onclick=null,!t.querySelector("img")&&t.addEventListener("click",()=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.multiple=!1,o.onchange=i=>{const n=i.target.files[0];if(n){const s=new FileReader;s.onload=r=>{t.innerHTML=`
                                <img src="${r.target.result}" 
                                     alt="Uploaded photo ${e+1}" 
                                     class="w-full h-full object-cover rounded-[16px] shadow-image">
                                <button class="delete-photo absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-70 hover:opacity-100 transition-opacity">
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                </button>
                            `,t.classList.add("image-hover","has-image");const a=t.querySelector(".delete-photo");a.onclick=d=>{d.stopPropagation(),t.innerHTML=`
                                    <div class="w-full h-full flex flex-col items-center justify-center">
                                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                                        <span class="text-xs">·∫¢nh ${e+1}</span>
                                    </div>
                                `,t.classList.remove("image-hover","has-image"),lucide?.createIcons()}},s.readAsDataURL(n)}},o.click()})})}static exportData(){try{const t=y.getAllData(),e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(o),n=document.createElement("a");return n.href=i,n.download=`diary-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),f.showNotification("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng! üì•","success"),!0}catch(t){return console.error("L·ªói khi xu·∫•t d·ªØ li·ªáu:",t),f.showNotification("L·ªói: Kh√¥ng th·ªÉ xu·∫•t d·ªØ li·ªáu","error"),!1}}static showNotification(t,e="info"){let o=document.getElementById("notification-container");o||(o=document.createElement("div"),o.id="notification-container",o.className="fixed top-4 right-4 z-50 space-y-2",document.body.appendChild(o));const i=document.createElement("div");i.className=`p-4 rounded-lg shadow-lg mb-2 animate-slideInUp ${e==="success"?"bg-green-100 text-green-800 border border-green-200":e==="error"?"bg-red-100 text-red-800 border border-red-200":e==="warning"?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-blue-100 text-blue-800 border border-blue-200"}`,i.innerHTML=`
            <div class="flex items-center space-x-2">
                <span>${t}</span>
            </div>
        `,o.appendChild(i),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateX(100%)",i.style.transition="all 0.3s ease",setTimeout(()=>{i.remove()},300)},3e3)}}class L{static saveDailyEntry(){const t=new Date,e=t.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),o=document.getElementById("current-date");o&&(o.textContent=e);const i=document.querySelector(".mood-btn.ring-4"),n=i?i.dataset.mood:"üòä",s={id:`entry_${t.getTime()}_${Math.random().toString(36).substr(2,9)}`,date:e,mood:n,achievements:document.getElementById("achievements")?.value.trim()||"",stress:document.getElementById("stress")?.value.trim()||"",gratitude1:document.getElementById("gratitude1")?.value.trim()||"",gratitude2:document.getElementById("gratitude2")?.value.trim()||"",gratitude3:document.getElementById("gratitude3")?.value.trim()||"",selfCare:Array.from(document.querySelectorAll(".pastel-checkbox input:checked")).map(r=>r.value),highlight:document.getElementById("highlight")?.value.trim()||"",photos:Array.from(document.querySelectorAll(".photo-upload img")).map(r=>r.src).filter(r=>!r.includes("plus")&&!r.includes("data:image/svg+xml")),content:document.getElementById("content")?.value.trim()||"",timestamp:t.getTime(),theme:document.body.className.match(/theme-(\w+)/)?.[1]||"mint"};if(!s.content||s.content.trim().length<5)return f.showNotification("Vui l√≤ng vi·∫øt n·ªôi dung nh·∫≠t k√Ω (√≠t nh·∫•t 5 k√Ω t·ª±)","warning"),document.getElementById("content")?.focus(),!1;try{let r=y.get("diaryEntries",[]);const a=r.findIndex(c=>c.date===e);a>=0?(r[a]=s,f.showNotification("ƒê√£ c·∫≠p nh·∫≠t nh·∫≠t k√Ω h√¥m nay! ‚ú®","success")):(r.unshift(s),f.showNotification("Nh·∫≠t k√Ω ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng! ‚ú®","success")),y.set("diaryEntries",r),s.highlight&&s.highlight.trim().length>0&&this.saveHighlightAsMoment(s);const d=document.querySelector("#diary-page button");return d&&(d.classList.add("success-pulse"),setTimeout(()=>d.classList.remove("success-pulse"),2e3)),typeof window.APP_STATE<"u"&&window.APP_STATE.currentView==="timeline"&&setTimeout(()=>{typeof window.TimelineManager<"u"&&window.TimelineManager.loadTimelineEntries()},500),this.resetForm(),typeof window.Utils<"u"&&window.Utils.updateStreakCounter(),!0}catch(r){return console.error("L·ªói khi l∆∞u entry:",r),f.showNotification("L·ªói: Kh√¥ng th·ªÉ l∆∞u nh·∫≠t k√Ω","error"),!1}}static saveHighlightAsMoment(t){const e={id:`moment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:t.highlight.substring(0,50),description:`T·ª´ nh·∫≠t k√Ω ng√†y ${t.date}: ${t.content.substring(0,100)}...`,date:t.date,mood:t.mood,type:"highlight",timestamp:t.timestamp};let o=y.get("moments",[]);o.unshift(e),y.set("moments",o)}static resetForm(){["achievements","stress","gratitude1","gratitude2","gratitude3","highlight","content"].forEach(n=>{const s=document.getElementById(n);s&&(s.value="")});const e=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(n=>{n.style.backgroundColor=e,n.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")});const o=document.querySelector('.mood-btn[data-mood="üòä"]');if(o){const n=getComputedStyle(document.body).getPropertyValue("--button-bg");o.style.backgroundColor=n,o.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(n=>{n.checked=!1}),document.querySelectorAll(".photo-upload").forEach((n,s)=>{n.innerHTML=`
                <div class="w-full h-full flex flex-col items-center justify-center">
                    <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                    <span class="text-xs">·∫¢nh ${s+1}</span>
                </div>
            `,n.classList.remove("image-hover","has-image")});const i=document.getElementById("save-status");i&&(i.textContent="S·∫µn s√†ng cho ng√†y m·ªõi!",i.classList.add("text-green-500"),setTimeout(()=>{i.classList.remove("text-green-500"),i.textContent="ƒê√£ l∆∞u t·ª± ƒë·ªông"},2e3)),setTimeout(()=>{document.getElementById("content")?.focus()},300),typeof lucide<"u"&&lucide.createIcons(),setTimeout(()=>{f.setupPhotoUpload()},100)}static loadTodayEntry(){const e=new Date().toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),o=document.getElementById("current-date");o&&(o.textContent=e);const n=y.get("diaryEntries",[]).find(s=>s.date===e);if(n){const s={achievements:n.achievements||"",stress:n.stress||"",gratitude1:n.gratitude1||"",gratitude2:n.gratitude2||"",gratitude3:n.gratitude3||"",highlight:n.highlight||"",content:n.content||""};Object.entries(s).forEach(([a,d])=>{const c=document.getElementById(a);c&&(c.value=d)});const r=document.querySelector(`.mood-btn[data-mood="${n.mood}"]`);if(r){const a=getComputedStyle(document.body).getPropertyValue("--button-bg"),d=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(c=>{c.style.backgroundColor=d,c.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),r.style.backgroundColor=a,r.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}if(n.selfCare&&document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(a=>{a.checked=n.selfCare.includes(a.value)}),n.photos&&n.photos.length>0){const a=document.querySelectorAll(".photo-upload");n.photos.slice(0,3).forEach((d,c)=>{if(a[c]){a[c].innerHTML=`
                            <img src="${d}" 
                                 alt="Uploaded photo ${c+1}" 
                                 class="w-full h-full object-cover rounded-[16px] shadow-image">
                            <button class="delete-photo absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-70 hover:opacity-100 transition-opacity">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        `,a[c].classList.add("image-hover","has-image");const p=a[c].querySelector(".delete-photo");p&&(p.onclick=u=>{u.stopPropagation();const w=`
                                    <div class="w-full h-full flex flex-col items-center justify-center">
                                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                                        <span class="text-xs">·∫¢nh ${c+1}</span>
                                    </div>
                                `;a[c].innerHTML=w,a[c].classList.remove("image-hover","has-image"),typeof lucide<"u"&&lucide.createIcons()})}})}}else this.resetFormForNewDay();setTimeout(()=>{f.setupPhotoUpload()},100)}static resetFormForNewDay(){["achievements","stress","gratitude1","gratitude2","gratitude3","highlight","content"].forEach(i=>{const n=document.getElementById(i);n&&(n.value="")}),document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(i=>{i.checked=!1}),document.querySelectorAll(".photo-upload").forEach((i,n)=>{i.innerHTML=`
                <div class="w-full h-full flex flex-col items-center justify-center">
                    <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                    <span class="text-xs">·∫¢nh ${n+1}</span>
                </div>
            `,i.classList.remove("image-hover","has-image")});const e=document.querySelector('.mood-btn[data-mood="üòä"]');if(e){const i=getComputedStyle(document.body).getPropertyValue("--button-bg"),n=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(s=>{s.style.backgroundColor=n,s.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),e.style.backgroundColor=i,e.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}const o=document.getElementById("save-status");o&&(o.textContent="S·∫µn s√†ng vi·∫øt nh·∫≠t k√Ω!",o.classList.add("text-blue-500"),setTimeout(()=>{o.classList.remove("text-blue-500"),o.textContent="ƒê√£ l∆∞u t·ª± ƒë·ªông"},2e3)),setTimeout(()=>{document.getElementById("content")?.focus()},300),typeof lucide<"u"&&lucide.createIcons()}static deleteEntry(t){try{let e=y.get("diaryEntries",[]);const o=e.length;return e=e.filter(i=>i.id!==t),e.length<o?(y.set("diaryEntries",e),typeof window.APP_STATE<"u"&&window.APP_STATE.currentView==="timeline"&&setTimeout(()=>{typeof window.TimelineManager<"u"&&window.TimelineManager.loadTimelineEntries()},100),typeof window.APP_STATE<"u"&&window.APP_STATE.currentView==="report"&&setTimeout(()=>{typeof window.ChartManager<"u"&&window.ChartManager.drawCharts()},100),f.showNotification("ƒê√£ x√≥a nh·∫≠t k√Ω th√†nh c√¥ng","success"),!0):(f.showNotification("Kh√¥ng t√¨m th·∫•y nh·∫≠t k√Ω ƒë·ªÉ x√≥a","error"),!1)}catch(e){return console.error("L·ªói khi x√≥a entry:",e),f.showNotification("L·ªói: Kh√¥ng th·ªÉ x√≥a nh·∫≠t k√Ω","error"),!1}}static loadEntryForEdit(t){try{const o=y.get("diaryEntries",[]).find(a=>a.id===t);if(!o)return f.showNotification("Kh√¥ng t√¨m th·∫•y nh·∫≠t k√Ω","error"),!1;typeof window.switchView<"u"&&window.switchView("diary");const i=document.getElementById("current-date");i&&(i.textContent=o.date);const n={achievements:o.achievements||"",stress:o.stress||"",gratitude1:o.gratitude1||"",gratitude2:o.gratitude2||"",gratitude3:o.gratitude3||"",highlight:o.highlight||"",content:o.content||""};Object.entries(n).forEach(([a,d])=>{const c=document.getElementById(a);c&&(c.value=d)});const s=document.querySelector(`.mood-btn[data-mood="${o.mood}"]`);if(s){const a=getComputedStyle(document.body).getPropertyValue("--button-bg"),d=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(c=>{c.style.backgroundColor=d,c.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),s.style.backgroundColor=a,s.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}if(document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(a=>{a.checked=o.selfCare?.includes(a.value)||!1}),document.querySelectorAll(".photo-upload").forEach((a,d)=>{a.innerHTML=`
                    <div class="w-full h-full flex flex-col items-center justify-center">
                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                        <span class="text-xs">·∫¢nh ${d+1}</span>
                    </div>
                `,a.classList.remove("image-hover","has-image")}),o.photos&&o.photos.length>0){const a=document.querySelectorAll(".photo-upload");o.photos.slice(0,3).forEach((d,c)=>{if(a[c]){a[c].innerHTML=`
                            <img src="${d}" 
                                 alt="Uploaded photo ${c+1}" 
                                 class="w-full h-full object-cover rounded-[16px] shadow-image">
                            <button class="delete-photo absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-70 hover:opacity-100 transition-opacity">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        `,a[c].classList.add("image-hover","has-image");const p=a[c].querySelector(".delete-photo");p&&(p.onclick=u=>{u.stopPropagation();const w=`
                                    <div class="w-full h-full flex flex-col items-center justify-center">
                                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                                        <span class="text-xs">·∫¢nh ${c+1}</span>
                                    </div>
                                `;a[c].innerHTML=w,a[c].classList.remove("image-hover","has-image"),typeof lucide<"u"&&lucide.createIcons()})}})}const r=document.getElementById("save-status");return r&&(r.textContent="ƒêang ch·ªânh s·ª≠a nh·∫≠t k√Ω c≈©",r.classList.add("text-yellow-500")),setTimeout(()=>{document.getElementById("content")?.focus()},300),setTimeout(()=>{f.setupPhotoUpload()},100),!0}catch(e){return console.error("L·ªói khi t·∫£i entry ƒë·ªÉ ch·ªânh s·ª≠a:",e),f.showNotification("L·ªói: Kh√¥ng th·ªÉ t·∫£i nh·∫≠t k√Ω","error"),!1}}}class x{static loadTimelineEntries(){try{const t=document.querySelector(".timeline-container");if(!t)return;const e=document.getElementById("timeline-loading");e&&e.classList.remove("hidden");const o=y.get("diaryEntries",[]),i=y.get("moments",[]);let n=[...o.map(c=>({...c,type:"entry"})),...i.map(c=>({...c,type:"moment"}))].sort((c,p)=>(p.timestamp||0)-(c.timestamp||0));n=this.applyFilters(n);const s=t.querySelectorAll(".timeline-item"),r=Array.from(s).slice(0,2);Array.from(s).slice(2).forEach(c=>c.remove());let d=document.getElementById("timeline-items-container");if(d?d.innerHTML="":(d=document.createElement("div"),d.id="timeline-items-container",t.appendChild(d)),n.length===0){const c=document.createElement("div");c.className="timeline-item text-center p-8 text-soft",c.innerHTML=`
                    <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã</p>
                `,d.appendChild(c),typeof lucide<"u"&&lucide.createIcons(),e&&e.classList.add("hidden");return}n.forEach((c,p)=>{const u=this.createTimelineItem(c,p);u.style.animationDelay=`${p*.1}s`,d.appendChild(u)}),e&&e.classList.add("hidden"),typeof lucide<"u"&&lucide.createIcons()}catch(t){console.error("L·ªói khi t·∫£i timeline:",t);const e=document.getElementById("timeline-loading");e&&e.classList.add("hidden")}}static applyFilters(t){const e=document.getElementById("search-input"),o=e?e.value.toLowerCase().trim():"",i=document.getElementById("mood-filter"),n=i?i.value:"",s=document.getElementById("type-filter"),r=s?s.value:"";return t.filter(a=>!(o&&![a.content||"",a.achievements||"",a.stress||"",a.highlight||"",a.name||"",a.description||"",a.gratitude1||"",a.gratitude2||"",a.gratitude3||""].join(" ").toLowerCase().includes(o)||n&&a.mood!==n||r&&(r==="entry"&&a.type!=="entry"||r==="moment"&&a.type!=="moment")))}static createTimelineItem(t,e){const o=t.type==="entry",i=document.createElement("div");return i.className="timeline-item",o?i.innerHTML=`
                <div class="bg-card p-6 rounded-card shadow-soft card-glow hover:transform hover:scale-[1.02] transition-all duration-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-accent-light text-accent mb-2">
                                <i data-lucide="book-open" class="w-3 h-3 inline mr-1"></i> Nh·∫≠t k√Ω
                            </span>
                            <h3 class="font-bold text-lg">${t.date||"Kh√¥ng c√≥ ng√†y"}</h3>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-3xl">${t.mood||"üòä"}</span>
                            <div class="flex space-x-2 mt-2">
                                <button onclick="editEntry('${t.id}')" class="text-xs px-3 py-1 bg-blue-100 text-blue-800 rounded-full hover:bg-blue-200 transition">
                                    <i data-lucide="edit" class="w-3 h-3 inline mr-1"></i>S·ª≠a
                                </button>
                                <button onclick="deleteEntry('${t.id}')" class="text-xs px-3 py-1 bg-red-100 text-red-800 rounded-full hover:bg-red-200 transition">
                                    <i data-lucide="trash-2" class="w-3 h-3 inline mr-1"></i>X√≥a
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    ${t.highlight?`
                        <div class="mb-4 p-3 rounded-lg bg-yellow-50 border border-yellow-100">
                            <div class="flex items-center text-yellow-800 mb-1">
                                <i data-lucide="star" class="w-4 h-4 mr-2"></i>
                                <span class="font-semibold">Kho·∫£nh kh·∫Øc ƒë·∫πp:</span>
                            </div>
                            <p class="text-sm">${t.highlight}</p>
                        </div>
                    `:""}
                    
                    ${t.achievements?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">üéØ Th√†nh t·ª±u:</span>
                            <p class="text-sm mt-1">${t.achievements}</p>
                        </div>
                    `:""}
                    
                    ${t.stress?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">‚ö†Ô∏è CƒÉng th·∫≥ng:</span>
                            <p class="text-sm mt-1">${t.stress}</p>
                        </div>
                    `:""}
                    
                    ${t.content?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">üìù N·ªôi dung:</span>
                            <p class="text-sm mt-1 line-clamp-3">${t.content}</p>
                        </div>
                    `:""}
                    
                    ${t.gratitude1||t.gratitude2||t.gratitude3?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">üôè Bi·∫øt ∆°n:</span>
                            <ul class="text-sm mt-1 space-y-1">
                                ${t.gratitude1?`<li>‚Ä¢ ${t.gratitude1}</li>`:""}
                                ${t.gratitude2?`<li>‚Ä¢ ${t.gratitude2}</li>`:""}
                                ${t.gratitude3?`<li>‚Ä¢ ${t.gratitude3}</li>`:""}
                            </ul>
                        </div>
                    `:""}
                    
                    ${t.selfCare&&t.selfCare.length>0?`
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <span class="font-semibold text-accent">üíÜ‚Äç‚ôÄÔ∏è Self-care:</span>
                            <div class="flex flex-wrap gap-1 mt-2">
                                ${t.selfCare.map(n=>`
                                    <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">${n}</span>
                                `).join("")}
                            </div>
                        </div>
                    `:""}
                    
                    ${t.photos&&t.photos.length>0?`
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <span class="font-semibold text-accent">üì∏ ·∫¢nh:</span>
                            <div class="flex space-x-2 mt-2 overflow-x-auto">
                                ${t.photos.slice(0,3).map(n=>`
                                    <img src="${n}" alt="Photo" class="w-20 h-20 object-cover rounded-lg flex-shrink-0">
                                `).join("")}
                            </div>
                        </div>
                    `:""}
                    
                    <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-soft">
                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i>
                        ${t.timestamp?new Date(t.timestamp).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"Kh√¥ng c√≥ th·ªùi gian"}
                    </div>
                </div>
            `:i.innerHTML=`
                <div class="bg-card p-6 rounded-card shadow-soft card-glow hover:transform hover:scale-[1.02] transition-all duration-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800 mb-2">
                                <i data-lucide="sparkles" class="w-3 h-3 inline mr-1"></i> Kho·∫£nh kh·∫Øc
                            </span>
                            <h3 class="font-bold text-lg">${t.name||"Kh√¥ng c√≥ t√™n"}</h3>
                            <p class="text-sm text-soft">${t.date||"Kh√¥ng c√≥ ng√†y"}</p>
                        </div>
                        <span class="text-3xl">${t.mood||"‚≠ê"}</span>
                    </div>
                    
                    ${t.description?`
                        <div class="mb-4">
                            <p class="text-sm">${t.description}</p>
                        </div>
                    `:""}
                    
                    <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-soft">
                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i>
                        ${t.timestamp?new Date(t.timestamp).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"Kh√¥ng c√≥ th·ªùi gian"}
                        ${t.type==="highlight"?' ‚Ä¢ <span class="text-yellow-600">T·ª´ highlight nh·∫≠t k√Ω</span>':""}
                    </div>
                </div>
            `,i}static clearFilters(){const t=document.getElementById("search-input"),e=document.getElementById("mood-filter"),o=document.getElementById("type-filter");t&&(t.value=""),e&&(e.value=""),o&&(o.value=""),this.loadTimelineEntries(),f.showNotification("ƒê√£ x√≥a t·∫•t c·∫£ b·ªô l·ªçc","info")}}class k{static saveReflection(){try{const t=new Date,e=t.getMonth()+1,o=t.getFullYear(),i={id:`reflection_${o}_${e}_${Math.random().toString(36).substr(2,9)}`,month:e,year:o,learned:document.getElementById("learned")?.value.trim()||"",proudOf:document.getElementById("proud-of")?.value.trim()||"",improvement:document.getElementById("improvement")?.value.trim()||"",timestamp:t.getTime()},n=`monthlyReflections_${o}_${e}`;return y.set(n,i),f.showNotification("Reflection ƒë√£ ƒë∆∞·ª£c l∆∞u! üìù","success"),!0}catch(t){return console.error("L·ªói khi l∆∞u reflection:",t),f.showNotification("L·ªói: Kh√¥ng th·ªÉ l∆∞u reflection","error"),!1}}static loadReflection(){try{const t=new Date,e=t.getMonth()+1,i=`monthlyReflections_${t.getFullYear()}_${e}`,n=y.get(i,{}),s=["Th√°ng 1","Th√°ng 2","Th√°ng 3","Th√°ng 4","Th√°ng 5","Th√°ng 6","Th√°ng 7","Th√°ng 8","Th√°ng 9","Th√°ng 10","Th√°ng 11","Th√°ng 12"],r=document.querySelector("#reflection-page h1");return r&&(r.textContent=`Reflection ${s[e-1]}`),document.getElementById("learned").value=n.learned||"",document.getElementById("proud-of").value=n.proudOf||"",document.getElementById("improvement").value=n.improvement||"",n}catch(t){return console.error("L·ªói khi t·∫£i reflection:",t),{}}}}const M={"üò¢":1,"üò°":2,"üò¥":3,"üòä":4,"‚ú®":5},K={"üò¢":"Bu·ªìn","üò°":"T·ª©c gi·∫≠n","üò¥":"M·ªát m·ªèi","üòä":"Vui v·∫ª","‚ú®":"Tuy·ªát v·ªùi"},B={"üòä":"#AEE6E6","üò¢":"#ADD8E6","üò°":"#FFC0CB","üò¥":"#D8BFD8","‚ú®":"#7FC7C7"};class C{static generateWeeklyData(t){const e=["CN","T2","T3","T4","T5","T6","T7"],o=[];for(let i=6;i>=0;i--){const n=new Date;n.setDate(n.getDate()-i);const s=n.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),r=t.find(a=>a.date===s);o.push({day:e[n.getDay()],moodValue:r?M[r.mood]||3:0,mood:r?r.mood:"",date:s,hasEntry:!!r})}return o}static drawWeeklyChart(t){const e=document.getElementById(t);if(!e)return;const o=y.get("diaryEntries",[]),i=this.generateWeeklyData(o);if(e.innerHTML="",!i.some(u=>u.hasEntry)){e.innerHTML=`
                <div class="text-center text-soft p-8">
                    <i data-lucide="bar-chart" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu tu·∫ßn n√†y</p>
                </div>`,typeof lucide<"u"&&lucide.createIcons();return}const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 500 300"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("preserveAspectRatio","xMidYMid meet");const r=getComputedStyle(document.body).getPropertyValue("--button-bg").trim(),a=getComputedStyle(document.body).getPropertyValue("--accent").trim(),d=getComputedStyle(document.body).getPropertyValue("--text-soft").trim();i.forEach((u,w)=>{const b=80+w*60,m=u.hasEntry?u.moodValue/5*180:10,g=240-m,h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x",b-20),h.setAttribute("y",g),h.setAttribute("width","40"),h.setAttribute("height",m),h.setAttribute("fill",u.hasEntry?r:"#E5E7EB"),h.setAttribute("rx","8"),h.setAttribute("opacity",u.hasEntry?"0.8":"0.3"),h.style.transition="all 0.3s ease",h.addEventListener("mouseenter",()=>{h.setAttribute("opacity","1")}),h.addEventListener("mouseleave",()=>{h.setAttribute("opacity",u.hasEntry?"0.8":"0.3")}),s.appendChild(h);const v=document.createElementNS("http://www.w3.org/2000/svg","text");if(v.setAttribute("x",b),v.setAttribute("y","270"),v.setAttribute("text-anchor","middle"),v.setAttribute("fill",d),v.setAttribute("font-weight","bold"),v.textContent=u.day,s.appendChild(v),u.hasEntry&&u.mood&&u.moodValue>0){const E=document.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("x",b),E.setAttribute("y",g-10),E.setAttribute("text-anchor","middle"),E.setAttribute("fill",r),E.setAttribute("font-size","20"),E.textContent=u.mood,s.appendChild(E)}});for(let u=1;u<=5;u++){const w=240-u/5*180,b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x","50"),b.setAttribute("y",w+3),b.setAttribute("text-anchor","end"),b.setAttribute("fill",d),b.setAttribute("font-size","12"),b.textContent=u,s.appendChild(b)}const c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1","60"),c.setAttribute("y1","240"),c.setAttribute("x2","440"),c.setAttribute("y2","240"),c.setAttribute("stroke",a),c.setAttribute("stroke-width","2"),s.appendChild(c);const p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1","60"),p.setAttribute("y1","60"),p.setAttribute("x2","60"),p.setAttribute("y2","240"),p.setAttribute("stroke",a),p.setAttribute("stroke-width","2"),s.appendChild(p),e.appendChild(s)}static generateMoodFrequencyData(t){const e={"üò¢":0,"üò°":0,"üò¥":0,"üòä":0,"‚ú®":0};return t.forEach(o=>{e.hasOwnProperty(o.mood)&&e[o.mood]++}),e}static drawPieChart(t){const e=document.getElementById(t);if(!e)return;const o=y.get("diaryEntries",[]),i=this.generateMoodFrequencyData(o),n=Object.values(i).reduce((g,h)=>g+h,0);if(e.innerHTML="",n===0){e.innerHTML=`
                <div class="text-center text-soft p-8">
                    <i data-lucide="pie-chart" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
                </div>`,typeof lucide<"u"&&lucide.createIcons();return}const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 200 200"),s.setAttribute("width","200"),s.setAttribute("height","200"),s.setAttribute("class","mx-auto");const r=100,a=100,d=80;let c=0;const p={};Object.entries(i).forEach(([g,h])=>{h>0&&(p[g]=h/n*100)}),Object.entries(p).forEach(([g,h])=>{if(h>0){const v=h/100*360,E=c,N=E+v,I=(E-90)*Math.PI/180,$=(N-90)*Math.PI/180,q=r+d*Math.cos(I),O=a+d*Math.sin(I),F=r+d*Math.cos($),j=a+d*Math.sin($),H=v>180?1:0,T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttribute("d",`
                    M ${r} ${a}
                    L ${q} ${O}
                    A ${d} ${d} 0 ${H} 1 ${F} ${j}
                    Z
                `),T.setAttribute("fill",B[g]),T.setAttribute("stroke","white"),T.setAttribute("stroke-width","2"),s.appendChild(T),c+=v}});const u=document.createElementNS("http://www.w3.org/2000/svg","circle");u.setAttribute("cx",r),u.setAttribute("cy",a),u.setAttribute("r",d*.3),u.setAttribute("fill","white"),s.appendChild(u);const w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",r),w.setAttribute("y",a),w.setAttribute("text-anchor","middle"),w.setAttribute("dy","5"),w.setAttribute("font-weight","bold"),w.setAttribute("fill",getComputedStyle(document.body).getPropertyValue("--accent").trim()),w.textContent=n,s.appendChild(w);const b=document.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",r),b.setAttribute("y",a+15),b.setAttribute("text-anchor","middle"),b.setAttribute("font-size","10"),b.setAttribute("fill",getComputedStyle(document.body).getPropertyValue("--text-soft").trim()),b.textContent="m·ª•c",s.appendChild(b),e.appendChild(s);const m=document.createElement("div");m.className="mt-6 flex flex-col gap-2",Object.entries(p).forEach(([g,h])=>{if(h>0){const v=i[g],E=document.createElement("div");E.className="flex items-center justify-between",E.innerHTML=`
                    <div class="flex items-center space-x-3">
                        <span class="w-4 h-4 rounded-full" style="background-color: ${B[g]}"></span>
                        <span class="text-sm">${g} ${K[g]}</span>
                    </div>
                    <div class="text-sm font-semibold">${Math.round(h)}% (${v})</div>
                `,m.appendChild(E)}}),e.appendChild(m)}static updateReportStats(){const t=y.get("diaryEntries",[]),e=(m,g)=>{const h=document.getElementById(m);h&&(h.textContent=g)};if(t.length===0){e("most-positive-day","--/--/----"),e("stressful-day","--/--/----"),e("days-written","0"),e("positive-rate","0%"),e("checklist-completed","0%"),e("avg-time","0 ph√∫t"),e("most-frequent-mood","üòä"),e("mood-percentage","0%"),e("most-positive-mood","‚ú®"),e("most-stressful-mood","üò°");return}const o=t.map(m=>({date:m.date,mood:m.mood,moodValue:M[m.mood]||3,contentLength:m.content?.length||0})),i=o.reduce((m,g)=>g.moodValue>m.moodValue?g:m,{moodValue:0,date:"--/--/----",mood:"‚ú®"}),n=o.reduce((m,g)=>g.moodValue<m.moodValue?g:m,{moodValue:6,date:"--/--/----",mood:"üò°"});e("most-positive-day",i.date||"--/--/----"),e("most-positive-mood",i.mood||"‚ú®"),e("stressful-day",n.date||"--/--/----"),e("most-stressful-mood",n.mood||"üò°"),e("days-written",t.length);const s=t.filter(m=>m.mood==="üòä"||m.mood==="‚ú®").length;e("positive-rate",`${Math.round(s/t.length*100)}%`);let r=0,a=0;t.forEach(m=>{r+=6,a+=m.selfCare?.length||0});const d=r>0?Math.round(a/r*100):0;e("checklist-completed",`${d}%`);const c=t.reduce((m,g)=>m+(g.content?.length||0),0),p=t.length>0?c/t.length:0,u=Math.max(1,Math.round(p/50));e("avg-time",`${u} ph√∫t`);const w=this.generateMoodFrequencyData(t),b=Object.values(w).reduce((m,g)=>m+g,0);if(b>0){const m=Object.entries(w).reduce((h,v)=>h[1]>v[1]?h:v),g=Math.round(m[1]/b*100);e("most-frequent-mood",m[0]),e("mood-percentage",`${g}%`)}else e("most-frequent-mood","üòä"),e("mood-percentage","0%")}static drawCharts(){this.drawWeeklyChart("weekly-chart"),this.drawPieChart("pie-chart"),this.updateReportStats()}}class U{static initialize(){console.log("Initializing report..."),C&&C.drawCharts()}static refresh(){this.initialize()}}const A={currentView:"diary"};function z(){const l=L.saveDailyEntry();return l&&(f.updateStreakCounter(),setTimeout(()=>{f.showNotification("Nh·∫≠t k√Ω ƒë√£ ƒë∆∞·ª£c l∆∞u v√† reset s·∫µn s√†ng cho ng√†y m·ªõi! üéâ","success")},500)),l}function W(l){return L.loadEntryForEdit(l)}function Y(l){return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh·∫≠t k√Ω n√†y kh√¥ng?")?L.deleteEntry(l):!1}function J(){const l=document.getElementById("moment-name")?.value.trim(),t=document.getElementById("moment-desc")?.value.trim();if(!l)return f.showNotification("Vui l√≤ng nh·∫≠p t√™n kho·∫£nh kh·∫Øc","warning"),!1;const e=new Date,o=e.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),i={id:`moment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:l,description:t,date:o,mood:"‚≠ê",type:"manual",timestamp:e.getTime()};let n=y.get("moments",[]);return n.unshift(i),y.set("moments",n),document.getElementById("moment-name").value="",document.getElementById("moment-desc").value="",document.getElementById("moment-input").classList.add("hidden"),f.showNotification("Kho·∫£nh kh·∫Øc ƒë√£ ƒë∆∞·ª£c l∆∞u! üåü","success"),A.currentView==="timeline"&&x.loadTimelineEntries(),!0}function X(){return k.saveReflection()}function Z(){return f.exportData()}function G(){return x.clearFilters()}function D(l){console.log("Switching to view:",l),A.currentView=l,document.querySelectorAll(".view").forEach(o=>{o.classList.add("hidden")});const t=document.getElementById(`${l}-page`);t&&(console.log("Showing view:",t.id),t.classList.remove("hidden")),document.querySelectorAll(".nav-item").forEach(o=>{o.classList.remove("bg-accent-light","font-bold"),o.style.backgroundColor=""});const e=document.querySelector(`.nav-item[data-view="${l}"]`);if(e){const o=getComputedStyle(document.body).getPropertyValue("--accent-light");e.classList.add("bg-accent-light","font-bold"),e.style.backgroundColor=o}switch(l){case"diary":console.log("Loading diary..."),L.loadTodayEntry();break;case"report":console.log("Loading report..."),C&&C.drawCharts();break;case"timeline":console.log("Loading timeline..."),x&&x.loadTimelineEntries();break;case"reflection":console.log("Loading reflection..."),k&&k.loadReflection();break}return window.scrollTo({top:0,behavior:"smooth"}),!0}function V(){const l=document.getElementById("theme-panel");l.classList.contains("hidden")?(l.classList.remove("hidden"),l.classList.add("animate-fadeIn"),l.classList.remove("animate-fadeOut")):(l.classList.add("animate-fadeOut"),setTimeout(()=>{l.classList.add("hidden"),l.classList.remove("animate-fadeOut")},300))}function Q(){const l=document.getElementById("moment-input");l.classList.contains("hidden")?(l.classList.remove("hidden"),l.classList.add("animate-fadeIn"),l.classList.remove("animate-fadeOut"),document.getElementById("moment-name").value="",document.getElementById("moment-desc").value="",setTimeout(()=>{document.getElementById("moment-name").focus()},100)):(l.classList.add("animate-fadeOut"),setTimeout(()=>{l.classList.add("hidden"),l.classList.remove("animate-fadeOut")},300))}function tt(){x&&x.loadTimelineEntries()}function et(){A.currentView==="report"&&C&&C.drawCharts()}function ot(){document.querySelectorAll(".mood-btn").forEach(l=>{l.addEventListener("click",t=>{const e=getComputedStyle(document.body).getPropertyValue("--button-bg"),o=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(i=>{i.style.backgroundColor=o,i.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),t.currentTarget.style.backgroundColor=e,t.currentTarget.classList.add("ring-4","ring-offset-2","ring-accent-light/50"),t.currentTarget.style.transform="scale(0.95)",setTimeout(()=>{t.currentTarget.style.transform=""},150)})})}function nt(){document.querySelectorAll(".pastel-checkbox").forEach(l=>{const t=l.querySelector('input[type="checkbox"]');l.addEventListener("click",e=>{setTimeout(()=>{if(t.checked){const o=l.querySelector(".checkbox-icon");o.classList.add("animate-bounce-once"),setTimeout(()=>{o.classList.remove("animate-bounce-once")},500)}},0)})})}function it(){let l;const t=()=>{clearTimeout(l),l=setTimeout(()=>{const e=document.getElementById("save-status");e&&(e.textContent="ƒêang l∆∞u...",e.classList.add("text-blue-500"),setTimeout(()=>{e.textContent="ƒê√£ l∆∞u t·ª± ƒë·ªông",e.classList.remove("text-blue-500")},500))},2e3)};document.querySelectorAll('textarea, input[type="text"]').forEach(e=>{e.addEventListener("input",t)})}function S(){console.log("Initializing app..."),typeof lucide<"u"&&lucide.createIcons(),y.initializeDefaults(),R();const t=new Date().toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),e=document.getElementById("current-date");e&&(e.textContent=t),ot(),nt(),f.setupPhotoUpload(),it(),f.updateStreakCounter(),L.loadTodayEntry(),D(A.currentView);const o=document.getElementById("search-input");o&&o.addEventListener("input",()=>{x&&x.loadTimelineEntries()}),document.addEventListener("click",i=>{const n=document.getElementById("theme-panel"),s=document.getElementById("theme-toggle");n&&!n.contains(i.target)&&s&&!s.contains(i.target)&&!n.classList.contains("hidden")&&V()}),console.log("App initialized successfully!")}window.switchView=D;window.toggleThemePanel=V;window.setTheme=P;window.showMomentInput=Q;window.filterTimelineEntries=tt;window.saveDailyEntry=z;window.saveMoment=J;window.saveReflection=X;window.clearFilters=G;window.exportData=Z;window.resizeChart=et;window.editEntry=W;window.deleteEntry=Y;window.TimelineManager=x;window.ChartManager=C;window.ReportManager=U;window.refreshReport=function(){C&&C.drawCharts(),f.showNotification("B√°o c√°o ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi!","success")};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S();
