(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class b{static get(t,e=null){try{const o=localStorage.getItem(t);return o?JSON.parse(o):e}catch(o){return console.error(`L·ªói khi ƒë·ªçc ${t}:`,o),e}}static set(t,e){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(o){return console.error(`L·ªói khi l∆∞u ${t}:`,o),!1}}static remove(t){localStorage.removeItem(t)}static clear(){localStorage.clear()}static getAllData(){return{diaryEntries:this.get("diaryEntries",[]),moments:this.get("moments",[]),settings:this.get("diarySettings",{}),exportDate:new Date().toISOString()}}static initializeDefaults(){this.get("diaryEntries")||this.set("diaryEntries",[]),this.get("moments")||this.set("moments",[]),this.get("diarySettings")||this.set("diarySettings",{theme:"mint"})}}function R(){const l=b.get("diarySettings",{theme:"mint"}).theme;D(l)}function D(l){var o;console.log("Setting theme to:",l),document.body.classList.remove("theme-mint","theme-pink","theme-lavender","theme-ocean","theme-night"),document.body.classList.add(`theme-${l}`),window.APP_STATE&&(window.APP_STATE.currentTheme=l);const t=b.get("diarySettings",{});t.theme=l,b.set("diarySettings",t);const e=document.getElementById("theme-panel");e&&e.classList.add("hidden"),window.ChartManager&&((o=window.APP_STATE)==null?void 0:o.currentView)==="report"&&setTimeout(()=>{window.ChartManager.drawCharts()},100),K()}function K(){const l=getComputedStyle(document.body).getPropertyValue("--accent-light"),t=getComputedStyle(document.body).getPropertyValue("--button-bg");document.querySelectorAll(".mood-btn").forEach(e=>{e.classList.contains("ring-4")?e.style.backgroundColor=t:e.style.backgroundColor=l})}class y{static calculateStreak(){const t=b.get("diaryEntries",[]);if(t.length===0)return 0;const e=new Set(t.map(s=>s.date)),o=Array.from(e).map(s=>{const[c,a,u]=s.split("/").map(Number);return new Date(u,a-1,c)}).sort((s,c)=>c-s);let i=0;const n=new Date;n.setHours(0,0,0,0);for(let s=0;s<o.length;s++){const c=new Date(n);if(c.setDate(c.getDate()-s),c.setHours(0,0,0,0),o[s].getTime()===c.getTime())i++;else break}return i}static updateStreakCounter(){const t=this.calculateStreak(),e=document.getElementById("streak-counter");e&&(e.innerHTML=`üî• ${t} ng√†y li√™n ti·∫øp`,t>0&&e.classList.add("animate-pulse"))}static setupPhotoUpload(){document.querySelectorAll(".photo-upload").forEach((t,e)=>{t.onclick=null,!t.querySelector("img")&&t.addEventListener("click",()=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.multiple=!1,o.onchange=i=>{const n=i.target.files[0];if(n){const s=new FileReader;s.onload=c=>{t.innerHTML=`
                                <img src="${c.target.result}" 
                                     alt="Uploaded photo ${e+1}" 
                                     class="w-full h-full object-cover rounded-[16px] shadow-image">
                                <button class="delete-photo absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-70 hover:opacity-100 transition-opacity">
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                </button>
                            `,t.classList.add("image-hover","has-image");const a=t.querySelector(".delete-photo");a.onclick=u=>{u.stopPropagation(),t.innerHTML=`
                                    <div class="w-full h-full flex flex-col items-center justify-center">
                                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                                        <span class="text-xs">·∫¢nh ${e+1}</span>
                                    </div>
                                `,t.classList.remove("image-hover","has-image"),lucide==null||lucide.createIcons()}},s.readAsDataURL(n)}},o.click()})})}static exportData(){try{const t=b.getAllData(),e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(o),n=document.createElement("a");return n.href=i,n.download=`diary-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),y.showNotification("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng! üì•","success"),!0}catch(t){return console.error("L·ªói khi xu·∫•t d·ªØ li·ªáu:",t),y.showNotification("L·ªói: Kh√¥ng th·ªÉ xu·∫•t d·ªØ li·ªáu","error"),!1}}static showNotification(t,e="info"){let o=document.getElementById("notification-container");o||(o=document.createElement("div"),o.id="notification-container",o.className="fixed top-4 right-4 z-50 space-y-2",document.body.appendChild(o));const i=document.createElement("div");i.className=`p-4 rounded-lg shadow-lg mb-2 animate-slideInUp ${e==="success"?"bg-green-100 text-green-800 border border-green-200":e==="error"?"bg-red-100 text-red-800 border border-red-200":e==="warning"?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-blue-100 text-blue-800 border border-blue-200"}`,i.innerHTML=`
            <div class="flex items-center space-x-2">
                <span>${t}</span>
            </div>
        `,o.appendChild(i),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateX(100%)",i.style.transition="all 0.3s ease",setTimeout(()=>{i.remove()},300)},3e3)}}class C{static saveDailyEntry(){var c,a,u,r,f,h,w,p,g;const t=new Date,e=t.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),o=document.getElementById("current-date");o&&(o.textContent=e);const i=document.querySelector(".mood-btn.ring-4"),n=i?i.dataset.mood:"üòä",s={id:`entry_${t.getTime()}_${Math.random().toString(36).substr(2,9)}`,date:e,mood:n,achievements:((c=document.getElementById("achievements"))==null?void 0:c.value.trim())||"",stress:((a=document.getElementById("stress"))==null?void 0:a.value.trim())||"",gratitude1:((u=document.getElementById("gratitude1"))==null?void 0:u.value.trim())||"",gratitude2:((r=document.getElementById("gratitude2"))==null?void 0:r.value.trim())||"",gratitude3:((f=document.getElementById("gratitude3"))==null?void 0:f.value.trim())||"",selfCare:Array.from(document.querySelectorAll(".pastel-checkbox input:checked")).map(d=>d.value),highlight:((h=document.getElementById("highlight"))==null?void 0:h.value.trim())||"",photos:Array.from(document.querySelectorAll(".photo-upload img")).map(d=>d.src).filter(d=>!d.includes("plus")&&!d.includes("data:image/svg+xml")),content:((w=document.getElementById("content"))==null?void 0:w.value.trim())||"",timestamp:t.getTime(),theme:((p=document.body.className.match(/theme-(\w+)/))==null?void 0:p[1])||"mint"};if(!s.content||s.content.trim().length<5)return y.showNotification("Vui l√≤ng vi·∫øt n·ªôi dung nh·∫≠t k√Ω (√≠t nh·∫•t 5 k√Ω t·ª±)","warning"),(g=document.getElementById("content"))==null||g.focus(),!1;try{let d=b.get("diaryEntries",[]);const m=d.findIndex(x=>x.date===e);m>=0?(d[m]=s,y.showNotification("ƒê√£ c·∫≠p nh·∫≠t nh·∫≠t k√Ω h√¥m nay! ‚ú®","success")):(d.unshift(s),y.showNotification("Nh·∫≠t k√Ω ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng! ‚ú®","success")),b.set("diaryEntries",d),s.highlight&&s.highlight.trim().length>0&&this.saveHighlightAsMoment(s);const v=document.querySelector("#diary-page button");return v&&(v.classList.add("success-pulse"),setTimeout(()=>v.classList.remove("success-pulse"),2e3)),typeof window.APP_STATE<"u"&&window.APP_STATE.currentView==="timeline"&&setTimeout(()=>{typeof window.TimelineManager<"u"&&window.TimelineManager.loadTimelineEntries()},500),this.resetForm(),typeof window.Utils<"u"&&window.Utils.updateStreakCounter(),!0}catch(d){return console.error("L·ªói khi l∆∞u entry:",d),y.showNotification("L·ªói: Kh√¥ng th·ªÉ l∆∞u nh·∫≠t k√Ω","error"),!1}}static saveHighlightAsMoment(t){const e={id:`moment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:t.highlight.substring(0,50),description:`T·ª´ nh·∫≠t k√Ω ng√†y ${t.date}: ${t.content.substring(0,100)}...`,date:t.date,mood:t.mood,type:"highlight",timestamp:t.timestamp};let o=b.get("moments",[]);o.unshift(e),b.set("moments",o)}static resetForm(){["achievements","stress","gratitude1","gratitude2","gratitude3","highlight","content"].forEach(n=>{const s=document.getElementById(n);s&&(s.value="")});const e=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(n=>{n.style.backgroundColor=e,n.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")});const o=document.querySelector('.mood-btn[data-mood="üòä"]');if(o){const n=getComputedStyle(document.body).getPropertyValue("--button-bg");o.style.backgroundColor=n,o.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(n=>{n.checked=!1}),document.querySelectorAll(".photo-upload").forEach((n,s)=>{n.innerHTML=`
                <div class="w-full h-full flex flex-col items-center justify-center">
                    <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                    <span class="text-xs">·∫¢nh ${s+1}</span>
                </div>
            `,n.classList.remove("image-hover","has-image")});const i=document.getElementById("save-status");i&&(i.textContent="S·∫µn s√†ng cho ng√†y m·ªõi!",i.classList.add("text-green-500"),setTimeout(()=>{i.classList.remove("text-green-500"),i.textContent="ƒê√£ l∆∞u t·ª± ƒë·ªông"},2e3)),setTimeout(()=>{var n;(n=document.getElementById("content"))==null||n.focus()},300),typeof lucide<"u"&&lucide.createIcons(),setTimeout(()=>{y.setupPhotoUpload()},100)}static loadTodayEntry(){const e=new Date().toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),o=document.getElementById("current-date");o&&(o.textContent=e);const n=b.get("diaryEntries",[]).find(s=>s.date===e);if(n){const s={achievements:n.achievements||"",stress:n.stress||"",gratitude1:n.gratitude1||"",gratitude2:n.gratitude2||"",gratitude3:n.gratitude3||"",highlight:n.highlight||"",content:n.content||""};Object.entries(s).forEach(([a,u])=>{const r=document.getElementById(a);r&&(r.value=u)});const c=document.querySelector(`.mood-btn[data-mood="${n.mood}"]`);if(c){const a=getComputedStyle(document.body).getPropertyValue("--button-bg"),u=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(r=>{r.style.backgroundColor=u,r.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),c.style.backgroundColor=a,c.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}if(n.selfCare&&document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(a=>{a.checked=n.selfCare.includes(a.value)}),n.photos&&n.photos.length>0){const a=document.querySelectorAll(".photo-upload");n.photos.slice(0,3).forEach((u,r)=>{if(a[r]){a[r].innerHTML=`
                            <img src="${u}" 
                                 alt="Uploaded photo ${r+1}" 
                                 class="w-full h-full object-cover rounded-[16px] shadow-image">
                            <button class="delete-photo absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-70 hover:opacity-100 transition-opacity">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        `,a[r].classList.add("image-hover","has-image");const f=a[r].querySelector(".delete-photo");f&&(f.onclick=h=>{h.stopPropagation();const w=`
                                    <div class="w-full h-full flex flex-col items-center justify-center">
                                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                                        <span class="text-xs">·∫¢nh ${r+1}</span>
                                    </div>
                                `;a[r].innerHTML=w,a[r].classList.remove("image-hover","has-image"),typeof lucide<"u"&&lucide.createIcons()})}})}}else this.resetFormForNewDay();setTimeout(()=>{y.setupPhotoUpload()},100)}static resetFormForNewDay(){["achievements","stress","gratitude1","gratitude2","gratitude3","highlight","content"].forEach(i=>{const n=document.getElementById(i);n&&(n.value="")}),document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(i=>{i.checked=!1}),document.querySelectorAll(".photo-upload").forEach((i,n)=>{i.innerHTML=`
                <div class="w-full h-full flex flex-col items-center justify-center">
                    <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                    <span class="text-xs">·∫¢nh ${n+1}</span>
                </div>
            `,i.classList.remove("image-hover","has-image")});const e=document.querySelector('.mood-btn[data-mood="üòä"]');if(e){const i=getComputedStyle(document.body).getPropertyValue("--button-bg"),n=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(s=>{s.style.backgroundColor=n,s.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),e.style.backgroundColor=i,e.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}const o=document.getElementById("save-status");o&&(o.textContent="S·∫µn s√†ng vi·∫øt nh·∫≠t k√Ω!",o.classList.add("text-blue-500"),setTimeout(()=>{o.classList.remove("text-blue-500"),o.textContent="ƒê√£ l∆∞u t·ª± ƒë·ªông"},2e3)),setTimeout(()=>{var i;(i=document.getElementById("content"))==null||i.focus()},300),typeof lucide<"u"&&lucide.createIcons()}static deleteEntry(t){try{let e=b.get("diaryEntries",[]);const o=e.length;return e=e.filter(i=>i.id!==t),e.length<o?(b.set("diaryEntries",e),typeof window.APP_STATE<"u"&&window.APP_STATE.currentView==="timeline"&&setTimeout(()=>{typeof window.TimelineManager<"u"&&window.TimelineManager.loadTimelineEntries()},100),typeof window.APP_STATE<"u"&&window.APP_STATE.currentView==="report"&&setTimeout(()=>{typeof window.ChartManager<"u"&&window.ChartManager.drawCharts()},100),y.showNotification("ƒê√£ x√≥a nh·∫≠t k√Ω th√†nh c√¥ng","success"),!0):(y.showNotification("Kh√¥ng t√¨m th·∫•y nh·∫≠t k√Ω ƒë·ªÉ x√≥a","error"),!1)}catch(e){return console.error("L·ªói khi x√≥a entry:",e),y.showNotification("L·ªói: Kh√¥ng th·ªÉ x√≥a nh·∫≠t k√Ω","error"),!1}}static loadEntryForEdit(t){try{const o=b.get("diaryEntries",[]).find(a=>a.id===t);if(!o)return y.showNotification("Kh√¥ng t√¨m th·∫•y nh·∫≠t k√Ω","error"),!1;typeof window.switchView<"u"&&window.switchView("diary");const i=document.getElementById("current-date");i&&(i.textContent=o.date);const n={achievements:o.achievements||"",stress:o.stress||"",gratitude1:o.gratitude1||"",gratitude2:o.gratitude2||"",gratitude3:o.gratitude3||"",highlight:o.highlight||"",content:o.content||""};Object.entries(n).forEach(([a,u])=>{const r=document.getElementById(a);r&&(r.value=u)});const s=document.querySelector(`.mood-btn[data-mood="${o.mood}"]`);if(s){const a=getComputedStyle(document.body).getPropertyValue("--button-bg"),u=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(r=>{r.style.backgroundColor=u,r.classList.remove("ring-4","ring-offset-2","ring-accent-light/50")}),s.style.backgroundColor=a,s.classList.add("ring-4","ring-offset-2","ring-accent-light/50")}if(document.querySelectorAll('.pastel-checkbox input[type="checkbox"]').forEach(a=>{var u;a.checked=((u=o.selfCare)==null?void 0:u.includes(a.value))||!1}),document.querySelectorAll(".photo-upload").forEach((a,u)=>{a.innerHTML=`
                    <div class="w-full h-full flex flex-col items-center justify-center">
                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                        <span class="text-xs">·∫¢nh ${u+1}</span>
                    </div>
                `,a.classList.remove("image-hover","has-image")}),o.photos&&o.photos.length>0){const a=document.querySelectorAll(".photo-upload");o.photos.slice(0,3).forEach((u,r)=>{if(a[r]){a[r].innerHTML=`
                            <img src="${u}" 
                                 alt="Uploaded photo ${r+1}" 
                                 class="w-full h-full object-cover rounded-[16px] shadow-image">
                            <button class="delete-photo absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-70 hover:opacity-100 transition-opacity">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        `,a[r].classList.add("image-hover","has-image");const f=a[r].querySelector(".delete-photo");f&&(f.onclick=h=>{h.stopPropagation();const w=`
                                    <div class="w-full h-full flex flex-col items-center justify-center">
                                        <i data-lucide="plus" class="w-8 h-8 mb-1"></i>
                                        <span class="text-xs">·∫¢nh ${r+1}</span>
                                    </div>
                                `;a[r].innerHTML=w,a[r].classList.remove("image-hover","has-image"),typeof lucide<"u"&&lucide.createIcons()})}})}const c=document.getElementById("save-status");return c&&(c.textContent="ƒêang ch·ªânh s·ª≠a nh·∫≠t k√Ω c≈©",c.classList.add("text-yellow-500")),setTimeout(()=>{var a;(a=document.getElementById("content"))==null||a.focus()},300),setTimeout(()=>{y.setupPhotoUpload()},100),!0}catch(e){return console.error("L·ªói khi t·∫£i entry ƒë·ªÉ ch·ªânh s·ª≠a:",e),y.showNotification("L·ªói: Kh√¥ng th·ªÉ t·∫£i nh·∫≠t k√Ω","error"),!1}}}class S{static loadTimelineEntries(){try{const t=document.querySelector(".timeline-container");if(!t)return;const e=document.getElementById("timeline-loading");e&&e.classList.remove("hidden");const o=b.get("diaryEntries",[]),i=b.get("moments",[]);let n=[...o.map(r=>({...r,type:"entry"})),...i.map(r=>({...r,type:"moment"}))].sort((r,f)=>(f.timestamp||0)-(r.timestamp||0));n=this.applyFilters(n);const s=t.querySelectorAll(".timeline-item"),c=Array.from(s).slice(0,2);Array.from(s).slice(2).forEach(r=>r.remove());let u=document.getElementById("timeline-items-container");if(u?u.innerHTML="":(u=document.createElement("div"),u.id="timeline-items-container",t.appendChild(u)),n.length===0){const r=document.createElement("div");r.className="timeline-item text-center p-8 text-soft",r.innerHTML=`
                    <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã</p>
                `,u.appendChild(r),typeof lucide<"u"&&lucide.createIcons(),e&&e.classList.add("hidden");return}n.forEach((r,f)=>{const h=this.createTimelineItem(r,f);h.style.animationDelay=`${f*.1}s`,u.appendChild(h)}),e&&e.classList.add("hidden"),typeof lucide<"u"&&lucide.createIcons()}catch(t){console.error("L·ªói khi t·∫£i timeline:",t);const e=document.getElementById("timeline-loading");e&&e.classList.add("hidden")}}static applyFilters(t){const e=document.getElementById("search-input"),o=e?e.value.toLowerCase().trim():"",i=document.getElementById("mood-filter"),n=i?i.value:"",s=document.getElementById("type-filter"),c=s?s.value:"";return t.filter(a=>!(o&&![a.content||"",a.achievements||"",a.stress||"",a.highlight||"",a.name||"",a.description||"",a.gratitude1||"",a.gratitude2||"",a.gratitude3||""].join(" ").toLowerCase().includes(o)||n&&a.mood!==n||c&&(c==="entry"&&a.type!=="entry"||c==="moment"&&a.type!=="moment")))}static createTimelineItem(t,e){const o=t.type==="entry",i=document.createElement("div");return i.className="timeline-item",o?i.innerHTML=`
                <div class="bg-card p-6 rounded-card shadow-soft card-glow hover:transform hover:scale-[1.02] transition-all duration-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-accent-light text-accent mb-2">
                                <i data-lucide="book-open" class="w-3 h-3 inline mr-1"></i> Nh·∫≠t k√Ω
                            </span>
                            <h3 class="font-bold text-lg">${t.date||"Kh√¥ng c√≥ ng√†y"}</h3>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-3xl">${t.mood||"üòä"}</span>
                            <div class="flex space-x-2 mt-2">
                                <button onclick="editEntry('${t.id}')" class="text-xs px-3 py-1 bg-blue-100 text-blue-800 rounded-full hover:bg-blue-200 transition">
                                    <i data-lucide="edit" class="w-3 h-3 inline mr-1"></i>S·ª≠a
                                </button>
                                <button onclick="deleteEntry('${t.id}')" class="text-xs px-3 py-1 bg-red-100 text-red-800 rounded-full hover:bg-red-200 transition">
                                    <i data-lucide="trash-2" class="w-3 h-3 inline mr-1"></i>X√≥a
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    ${t.highlight?`
                        <div class="mb-4 p-3 rounded-lg bg-yellow-50 border border-yellow-100">
                            <div class="flex items-center text-yellow-800 mb-1">
                                <i data-lucide="star" class="w-4 h-4 mr-2"></i>
                                <span class="font-semibold">Kho·∫£nh kh·∫Øc ƒë·∫πp:</span>
                            </div>
                            <p class="text-sm">${t.highlight}</p>
                        </div>
                    `:""}
                    
                    ${t.achievements?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">üéØ Th√†nh t·ª±u:</span>
                            <p class="text-sm mt-1">${t.achievements}</p>
                        </div>
                    `:""}
                    
                    ${t.stress?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">‚ö†Ô∏è CƒÉng th·∫≥ng:</span>
                            <p class="text-sm mt-1">${t.stress}</p>
                        </div>
                    `:""}
                    
                    ${t.content?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">üìù N·ªôi dung:</span>
                            <p class="text-sm mt-1 line-clamp-3">${t.content}</p>
                        </div>
                    `:""}
                    
                    ${t.gratitude1||t.gratitude2||t.gratitude3?`
                        <div class="mb-3">
                            <span class="font-semibold text-accent">üôè Bi·∫øt ∆°n:</span>
                            <ul class="text-sm mt-1 space-y-1">
                                ${t.gratitude1?`<li>‚Ä¢ ${t.gratitude1}</li>`:""}
                                ${t.gratitude2?`<li>‚Ä¢ ${t.gratitude2}</li>`:""}
                                ${t.gratitude3?`<li>‚Ä¢ ${t.gratitude3}</li>`:""}
                            </ul>
                        </div>
                    `:""}
                    
                    ${t.selfCare&&t.selfCare.length>0?`
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <span class="font-semibold text-accent">üíÜ‚Äç‚ôÄÔ∏è Self-care:</span>
                            <div class="flex flex-wrap gap-1 mt-2">
                                ${t.selfCare.map(n=>`
                                    <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">${n}</span>
                                `).join("")}
                            </div>
                        </div>
                    `:""}
                    
                    ${t.photos&&t.photos.length>0?`
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <span class="font-semibold text-accent">üì∏ ·∫¢nh:</span>
                            <div class="flex space-x-2 mt-2 overflow-x-auto">
                                ${t.photos.slice(0,3).map(n=>`
                                    <img src="${n}" alt="Photo" class="w-20 h-20 object-cover rounded-lg flex-shrink-0">
                                `).join("")}
                            </div>
                        </div>
                    `:""}
                    
                    <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-soft">
                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i>
                        ${t.timestamp?new Date(t.timestamp).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"Kh√¥ng c√≥ th·ªùi gian"}
                    </div>
                </div>
            `:i.innerHTML=`
                <div class="bg-card p-6 rounded-card shadow-soft card-glow hover:transform hover:scale-[1.02] transition-all duration-300">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <span class="inline-block px-3 py-1 rounded-full text-xs font-semibold bg-purple-100 text-purple-800 mb-2">
                                <i data-lucide="sparkles" class="w-3 h-3 inline mr-1"></i> Kho·∫£nh kh·∫Øc
                            </span>
                            <h3 class="font-bold text-lg">${t.name||"Kh√¥ng c√≥ t√™n"}</h3>
                            <p class="text-sm text-soft">${t.date||"Kh√¥ng c√≥ ng√†y"}</p>
                        </div>
                        <span class="text-3xl">${t.mood||"‚≠ê"}</span>
                    </div>
                    
                    ${t.description?`
                        <div class="mb-4">
                            <p class="text-sm">${t.description}</p>
                        </div>
                    `:""}
                    
                    <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-soft">
                        <i data-lucide="clock" class="w-3 h-3 inline mr-1"></i>
                        ${t.timestamp?new Date(t.timestamp).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"Kh√¥ng c√≥ th·ªùi gian"}
                        ${t.type==="highlight"?' ‚Ä¢ <span class="text-yellow-600">T·ª´ highlight nh·∫≠t k√Ω</span>':""}
                    </div>
                </div>
            `,i}static clearFilters(){const t=document.getElementById("search-input"),e=document.getElementById("mood-filter"),o=document.getElementById("type-filter");t&&(t.value=""),e&&(e.value=""),o&&(o.value=""),this.loadTimelineEntries(),y.showNotification("ƒê√£ x√≥a t·∫•t c·∫£ b·ªô l·ªçc","info")}}class V{static saveReflection(){var t,e,o;try{const i=new Date,n=i.getMonth()+1,s=i.getFullYear(),c={id:`reflection_${s}_${n}_${Math.random().toString(36).substr(2,9)}`,month:n,year:s,learned:((t=document.getElementById("learned"))==null?void 0:t.value.trim())||"",proudOf:((e=document.getElementById("proud-of"))==null?void 0:e.value.trim())||"",improvement:((o=document.getElementById("improvement"))==null?void 0:o.value.trim())||"",timestamp:i.getTime()},a=`monthlyReflections_${s}_${n}`;return b.set(a,c),y.showNotification("Reflection ƒë√£ ƒë∆∞·ª£c l∆∞u! üìù","success"),!0}catch(i){return console.error("L·ªói khi l∆∞u reflection:",i),y.showNotification("L·ªói: Kh√¥ng th·ªÉ l∆∞u reflection","error"),!1}}static loadReflection(){try{const t=new Date,e=t.getMonth()+1,i=`monthlyReflections_${t.getFullYear()}_${e}`,n=b.get(i,{}),s=["Th√°ng 1","Th√°ng 2","Th√°ng 3","Th√°ng 4","Th√°ng 5","Th√°ng 6","Th√°ng 7","Th√°ng 8","Th√°ng 9","Th√°ng 10","Th√°ng 11","Th√°ng 12"],c=document.querySelector("#reflection-page h1");return c&&(c.textContent=`Reflection ${s[e-1]}`),document.getElementById("learned").value=n.learned||"",document.getElementById("proud-of").value=n.proudOf||"",document.getElementById("improvement").value=n.improvement||"",n}catch(t){return console.error("L·ªói khi t·∫£i reflection:",t),{}}}}const k={"üò¢":1,"üò°":2,"üò¥":3,"üòä":4,"‚ú®":5},U={"üò¢":"Bu·ªìn","üò°":"T·ª©c gi·∫≠n","üò¥":"M·ªát m·ªèi","üòä":"Vui v·∫ª","‚ú®":"Tuy·ªát v·ªùi"},I={"üòä":"#AEE6E6","üò¢":"#ADD8E6","üò°":"#FFC0CB","üò¥":"#D8BFD8","‚ú®":"#7FC7C7"};class ${static generateWeeklyData(t){const e=["CN","T2","T3","T4","T5","T6","T7"],o=[];for(let i=6;i>=0;i--){const n=new Date;n.setDate(n.getDate()-i);const s=n.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),c=t.find(a=>a.date===s);o.push({day:e[n.getDay()],moodValue:c?k[c.mood]||3:0,mood:c?c.mood:"",date:s,hasEntry:!!c})}return o}static drawWeeklyChart(t){const e=document.getElementById(t);if(!e)return;const o=b.get("diaryEntries",[]),i=this.generateWeeklyData(o);if(e.innerHTML="",!i.some(h=>h.hasEntry)){e.innerHTML=`
                <div class="text-center text-soft p-8">
                    <i data-lucide="bar-chart" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu tu·∫ßn n√†y</p>
                </div>`,typeof lucide<"u"&&lucide.createIcons();return}const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 500 300"),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("preserveAspectRatio","xMidYMid meet");const c=getComputedStyle(document.body).getPropertyValue("--button-bg").trim(),a=getComputedStyle(document.body).getPropertyValue("--accent").trim(),u=getComputedStyle(document.body).getPropertyValue("--text-soft").trim();i.forEach((h,w)=>{const p=80+w*60,g=h.hasEntry?h.moodValue/5*180:10,d=240-g,m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x",p-20),m.setAttribute("y",d),m.setAttribute("width","40"),m.setAttribute("height",g),m.setAttribute("fill",h.hasEntry?c:"#E5E7EB"),m.setAttribute("rx","8"),m.setAttribute("opacity",h.hasEntry?"0.8":"0.3"),m.style.transition="all 0.3s ease",m.addEventListener("mouseenter",()=>{m.setAttribute("opacity","1")}),m.addEventListener("mouseleave",()=>{m.setAttribute("opacity",h.hasEntry?"0.8":"0.3")}),s.appendChild(m);const v=document.createElementNS("http://www.w3.org/2000/svg","text");if(v.setAttribute("x",p),v.setAttribute("y","270"),v.setAttribute("text-anchor","middle"),v.setAttribute("fill",u),v.setAttribute("font-weight","bold"),v.textContent=h.day,s.appendChild(v),h.hasEntry&&h.mood&&h.moodValue>0){const x=document.createElementNS("http://www.w3.org/2000/svg","text");x.setAttribute("x",p),x.setAttribute("y",d-10),x.setAttribute("text-anchor","middle"),x.setAttribute("fill",c),x.setAttribute("font-size","20"),x.textContent=h.mood,s.appendChild(x)}});for(let h=1;h<=5;h++){const w=240-h/5*180,p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x","50"),p.setAttribute("y",w+3),p.setAttribute("text-anchor","end"),p.setAttribute("fill",u),p.setAttribute("font-size","12"),p.textContent=h,s.appendChild(p)}const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","60"),r.setAttribute("y1","240"),r.setAttribute("x2","440"),r.setAttribute("y2","240"),r.setAttribute("stroke",a),r.setAttribute("stroke-width","2"),s.appendChild(r);const f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1","60"),f.setAttribute("y1","60"),f.setAttribute("x2","60"),f.setAttribute("y2","240"),f.setAttribute("stroke",a),f.setAttribute("stroke-width","2"),s.appendChild(f),e.appendChild(s)}static generateMoodFrequencyData(t){const e={"üò¢":0,"üò°":0,"üò¥":0,"üòä":0,"‚ú®":0};return t.forEach(o=>{e.hasOwnProperty(o.mood)&&e[o.mood]++}),e}static drawPieChart(t){const e=document.getElementById(t);if(!e)return;const o=b.get("diaryEntries",[]),i=this.generateMoodFrequencyData(o),n=Object.values(i).reduce((d,m)=>d+m,0);if(e.innerHTML="",n===0){e.innerHTML=`
                <div class="text-center text-soft p-8">
                    <i data-lucide="pie-chart" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu</p>
                </div>`,typeof lucide<"u"&&lucide.createIcons();return}const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 200 200"),s.setAttribute("width","200"),s.setAttribute("height","200"),s.setAttribute("class","mx-auto");const c=100,a=100,u=80;let r=0;const f={};Object.entries(i).forEach(([d,m])=>{m>0&&(f[d]=m/n*100)}),Object.entries(f).forEach(([d,m])=>{if(m>0){const v=m/100*360,x=r,N=x+v,A=(x-90)*Math.PI/180,L=(N-90)*Math.PI/180,O=c+u*Math.cos(A),F=a+u*Math.sin(A),j=c+u*Math.cos(L),H=a+u*Math.sin(L),_=v>180?1:0,E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",`
                    M ${c} ${a}
                    L ${O} ${F}
                    A ${u} ${u} 0 ${_} 1 ${j} ${H}
                    Z
                `),E.setAttribute("fill",I[d]),E.setAttribute("stroke","white"),E.setAttribute("stroke-width","2"),s.appendChild(E),r+=v}});const h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.setAttribute("cx",c),h.setAttribute("cy",a),h.setAttribute("r",u*.3),h.setAttribute("fill","white"),s.appendChild(h);const w=document.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",c),w.setAttribute("y",a),w.setAttribute("text-anchor","middle"),w.setAttribute("dy","5"),w.setAttribute("font-weight","bold"),w.setAttribute("fill",getComputedStyle(document.body).getPropertyValue("--accent").trim()),w.textContent=n,s.appendChild(w);const p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",c),p.setAttribute("y",a+15),p.setAttribute("text-anchor","middle"),p.setAttribute("font-size","10"),p.setAttribute("fill",getComputedStyle(document.body).getPropertyValue("--text-soft").trim()),p.textContent="m·ª•c",s.appendChild(p),e.appendChild(s);const g=document.createElement("div");g.className="mt-6 flex flex-col gap-2",Object.entries(f).forEach(([d,m])=>{if(m>0){const v=i[d],x=document.createElement("div");x.className="flex items-center justify-between",x.innerHTML=`
                    <div class="flex items-center space-x-3">
                        <span class="w-4 h-4 rounded-full" style="background-color: ${I[d]}"></span>
                        <span class="text-sm">${d} ${U[d]}</span>
                    </div>
                    <div class="text-sm font-semibold">${Math.round(m)}% (${v})</div>
                `,g.appendChild(x)}}),e.appendChild(g)}static updateReportStats(){const t=b.get("diaryEntries",[]),e=(g,d)=>{const m=document.getElementById(g);m&&(m.textContent=d)};if(t.length===0){e("most-positive-day","--/--/----"),e("stressful-day","--/--/----"),e("days-written","0"),e("positive-rate","0%"),e("checklist-completed","0%"),e("avg-time","0 ph√∫t"),e("most-frequent-mood","üòä"),e("mood-percentage","0%"),e("most-positive-mood","‚ú®"),e("most-stressful-mood","üò°");return}const o=t.map(g=>{var d;return{date:g.date,mood:g.mood,moodValue:k[g.mood]||3,contentLength:((d=g.content)==null?void 0:d.length)||0}}),i=o.reduce((g,d)=>d.moodValue>g.moodValue?d:g,{moodValue:0,date:"--/--/----",mood:"‚ú®"}),n=o.reduce((g,d)=>d.moodValue<g.moodValue?d:g,{moodValue:6,date:"--/--/----",mood:"üò°"});e("most-positive-day",i.date||"--/--/----"),e("most-positive-mood",i.mood||"‚ú®"),e("stressful-day",n.date||"--/--/----"),e("most-stressful-mood",n.mood||"üò°"),e("days-written",t.length);const s=t.filter(g=>g.mood==="üòä"||g.mood==="‚ú®").length;e("positive-rate",`${Math.round(s/t.length*100)}%`);let c=0,a=0;t.forEach(g=>{var d;c+=6,a+=((d=g.selfCare)==null?void 0:d.length)||0});const u=c>0?Math.round(a/c*100):0;e("checklist-completed",`${u}%`);const r=t.reduce((g,d)=>{var m;return g+(((m=d.content)==null?void 0:m.length)||0)},0),f=t.length>0?r/t.length:0,h=Math.max(1,Math.round(f/50));e("avg-time",`${h} ph√∫t`);const w=this.generateMoodFrequencyData(t),p=Object.values(w).reduce((g,d)=>g+d,0);if(p>0){const g=Object.entries(w).reduce((m,v)=>m[1]>v[1]?m:v),d=Math.round(g[1]/p*100);e("most-frequent-mood",g[0]),e("mood-percentage",`${d}%`)}else e("most-frequent-mood","üòä"),e("mood-percentage","0%")}static drawCharts(){this.drawWeeklyChart("weekly-chart"),this.drawPieChart("pie-chart"),this.updateReportStats()}}const T={currentView:"diary"};function z(){const l=C.saveDailyEntry();return l&&(y.updateStreakCounter(),setTimeout(()=>{y.showNotification("Nh·∫≠t k√Ω ƒë√£ ƒë∆∞·ª£c l∆∞u v√† reset s·∫µn s√†ng cho ng√†y m·ªõi! üéâ","success")},500)),l}function W(l){return C.loadEntryForEdit(l)}function Y(l){return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh·∫≠t k√Ω n√†y kh√¥ng?")?C.deleteEntry(l):!1}function J(){var s,c;const l=(s=document.getElementById("moment-name"))==null?void 0:s.value.trim(),t=(c=document.getElementById("moment-desc"))==null?void 0:c.value.trim();if(!l)return y.showNotification("Vui l√≤ng nh·∫≠p t√™n kho·∫£nh kh·∫Øc","warning"),!1;const e=new Date,o=e.toLocaleDateString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit"}),i={id:`moment_${Date.now()}_${Math.random().toString(36).slice(2)}`,name:l,description:t,date:o,mood:"‚≠ê",type:"manual",timestamp:e.getTime()},n=b.get("moments",[]);return n.unshift(i),b.set("moments",n),document.getElementById("moment-name").value="",document.getElementById("moment-desc").value="",document.getElementById("moment-input").classList.add("hidden"),y.showNotification("Kho·∫£nh kh·∫Øc ƒë√£ ƒë∆∞·ª£c l∆∞u! üåü","success"),T.currentView==="timeline"&&S.loadTimelineEntries(),!0}function X(){return V.saveReflection()}function Z(){return y.exportData()}function G(){return S.clearFilters()}function q(l){var e;T.currentView=l,document.querySelectorAll(".view").forEach(o=>o.classList.add("hidden")),(e=document.getElementById(`${l}-page`))==null||e.classList.remove("hidden"),document.querySelectorAll(".nav-item").forEach(o=>{o.classList.remove("bg-accent-light","font-bold"),o.style.backgroundColor=""});const t=document.querySelector(`.nav-item[data-view="${l}"]`);if(t){const o=getComputedStyle(document.body).getPropertyValue("--accent-light");t.classList.add("bg-accent-light","font-bold"),t.style.backgroundColor=o}l==="report"&&tt(),l==="timeline"&&S.loadTimelineEntries(),l==="reflection"&&V.loadReflection(),window.scrollTo({top:0,behavior:window.innerWidth<768?"auto":"smooth"})}function Q(){const l=document.getElementById("theme-panel");l&&(l.classList.contains("hidden")?(l.classList.remove("hidden"),window.innerWidth>=768&&l.classList.add("animate-fadeIn")):(l.classList.add("animate-fadeOut"),setTimeout(()=>{l.classList.add("hidden"),l.classList.remove("animate-fadeOut")},300)))}let M=!1;function tt(){M||(M=!0,"requestIdleCallback"in window?requestIdleCallback(()=>$.drawCharts()):setTimeout(()=>$.drawCharts(),300))}function et(){document.querySelectorAll(".mood-btn").forEach(l=>{l.addEventListener("click",t=>{const e=getComputedStyle(document.body).getPropertyValue("--button-bg"),o=getComputedStyle(document.body).getPropertyValue("--accent-light");document.querySelectorAll(".mood-btn").forEach(i=>{i.style.backgroundColor=o,i.classList.remove("ring-4","ring-offset-2")}),t.currentTarget.style.backgroundColor=e,t.currentTarget.classList.add("ring-4","ring-offset-2"),t.currentTarget.style.transform="scale(0.95)",setTimeout(()=>t.currentTarget.style.transform="",150)})})}function ot(){document.querySelectorAll(".pastel-checkbox").forEach(l=>{const t=l.querySelector("input");l.addEventListener("click",()=>{if(t.checked){const e=l.querySelector(".checkbox-icon");e==null||e.classList.add("animate-bounce-once"),setTimeout(()=>{e==null||e.classList.remove("animate-bounce-once")},500)}})})}function nt(){let l;document.addEventListener("input",t=>{t.target.matches('textarea, input[type="text"]')&&(clearTimeout(l),l=setTimeout(()=>{const e=document.getElementById("save-status");e&&(e.textContent="ƒê√£ l∆∞u t·ª± ƒë·ªông")},2e3))})}function B(){var l;typeof lucide<"u"&&lucide.createIcons(),et(),ot(),y.setupPhotoUpload(),nt(),(l=document.getElementById("photo-journal"))==null||l.classList.remove("hidden")}function P(){document.documentElement.classList.add("preload"),window.addEventListener("load",()=>{document.documentElement.classList.remove("preload")}),b.initializeDefaults(),R(),y.updateStreakCounter(),C.loadTodayEntry(),q(T.currentView),"requestIdleCallback"in window?requestIdleCallback(B):setTimeout(B,500)}window.switchView=q;window.toggleThemePanel=Q;window.setTheme=D;window.saveDailyEntry=z;window.saveMoment=J;window.saveReflection=X;window.clearFilters=G;window.exportData=Z;window.editEntry=W;window.deleteEntry=Y;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P();
